(function(e){e.fn.timePicker=function(h){var i=e.extend({},e.fn.timePicker.defaults,h);return this.each(function(){e.timePicker(this,i)})};e.timePicker=function(j,h){var i=e(j)[0];return i.timePicker||(i.timePicker=new jQuery._timePicker(i,h))};e._timePicker=function(s,m){var v=false;var t=false;var k=d(m.startTime,m);var p=d(m.endTime,m);var q=d(m.selectedTime,m);e(s).attr("autocomplete","OFF");if(q){s.value=g(q,m)}var j=[];var l=new Date(k);while(l<=p){j[j.length]=g(l,m);l=new Date(l.setMinutes(l.getMinutes()+m.step))}var u=e('<div class="time-picker'+(m.show24Hours?"":" time-picker-12hours")+'"></div>');var n=e("<ul></ul>");for(var o=0;o<j.length;o++){n.append("<li>"+j[o]+"</li>")}u.append(n);u.appendTo("body").hide();u.mouseover(function(){v=true}).mouseout(function(){v=false});e("li",n).mouseover(function(){if(!t){e("li.selected",u).removeClass("selected");e(this).addClass("selected")}}).mousedown(function(){v=true}).click(function(){f(s,this,u,m);v=false});var r=function(){if(u.is(":visible")){return false}e("li",u).removeClass("selected");var y=e(s).offset();u.css({top:y.top+s.offsetHeight,left:y.left});u.show();var A=s.value?b(s.value,m):k;var z=k.getHours()*60+k.getMinutes();var x=(A.getHours()*60+A.getMinutes())-z;var i=Math.round(x/m.step);var w=a(new Date(0,0,0,0,(i*m.step+z),0));w=(k<w&&w<=p)?w:k;var B=e("li:contains("+g(w,m)+")",u);if(B.length){B.addClass("selected");u[0].scrollTop=B[0].offsetTop}return true};e(s).focus(r).click(r);e(s).blur(function(){if(!v){u.hide()}});var h=(e.browser.opera||e.browser.mozilla)?"keypress":"keydown";e(s)[h](function(A){var i;t=true;var z=u[0].scrollTop;switch(A.keyCode){case 38:if(r()){return false}i=e("li.selected",n);var x=i.prev().addClass("selected")[0];if(x){i.removeClass("selected");if(x.offsetTop<z){u[0].scrollTop=z-x.offsetHeight}}else{i.removeClass("selected");x=e("li:last",n).addClass("selected")[0];u[0].scrollTop=x.offsetTop-x.offsetHeight}return false;break;case 40:if(r()){return false}i=e("li.selected",n);var w=i.next().addClass("selected")[0];if(w){i.removeClass("selected");if(w.offsetTop+w.offsetHeight>z+u[0].offsetHeight){u[0].scrollTop=z+w.offsetHeight}}else{i.removeClass("selected");w=e("li:first",n).addClass("selected")[0];u[0].scrollTop=0}return false;break;case 13:if(u.is(":visible")){var y=e("li.selected",n)[0];f(s,y,u,m)}return false;break;case 27:u.hide();return false;break}return true});e(s).keyup(function(i){t=false});this.getTime=function(){return b(s.value,m)};this.setTime=function(i){s.value=g(a(i),m);e(s).change()}};e.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:true,selectedTime:null};function f(k,j,h,i){k.value=e(j).text();e(k).change();if(!e.browser.msie){k.focus()}h.hide()}function g(m,l){var k=m.getHours();var i=l.show24Hours?k:(((k+11)%12)+1);var j=m.getMinutes();return c(i)+l.separator+c(j)+(l.show24Hours?"":((k<12)?" AM":" PM"))}function c(h){return(h<10?"0":"")+h}function d(h,i){return(typeof h=="object")?a(h):b(h,i)}function b(i,k){if(i){var m=i.split(k.separator);var h=parseFloat(m[0]);var j=parseFloat(m[1]);if(!k.show24Hours){if(h===12&&i.indexOf("AM")!==-1){h=0}else{if(h!==12&&i.indexOf("PM")!==-1){h+=12}}}var l=new Date(0,0,0,h,j,0);return a(l)}return null}function a(h){h.setFullYear(2001);h.setMonth(0);h.setDate(0);return h}})(jQuery);
